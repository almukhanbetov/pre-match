name: ğŸš€ Deploy to VPS
on:
  push:
    branches:
      - main
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¥ Checkout ĞºĞ¾Ğ´Ğ°
        uses: actions/checkout@v3

      - name: ğŸ” Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° SSH-ĞºĞ»ÑÑ‡Ğ°
        uses: webfactory/ssh-agent@v0.7.0
        with:
          ssh-private-key: ${{ secrets.VPS_PRIVATE_KEY }}

      - name: ğŸš€ ĞŸĞ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğ¸ Ğ´ĞµĞ¿Ğ»Ğ¾Ğ¹ Ğ½Ğ° VPS
        run: |
          ssh -o StrictHostKeyChecking=no ${{ secrets.VPS_USER }}@${{ secrets.VPS_HOST }} << 'EOF'
            echo "ğŸ”„ ĞŸĞµÑ€ĞµÑ…Ğ¾Ğ´ Ğ² Ğ¿Ğ°Ğ¿ĞºÑƒ"
            cd /opt/pre-match || exit 1

            echo "ğŸ“¦ ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ĞºĞ¾Ğ´Ğ°"
            git pull origin main

            echo "ğŸ“¦ ĞŸĞµÑ€ĞµÑĞ±Ğ¾Ñ€ĞºĞ° ĞºĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€Ğ¾Ğ²"
            docker-compose build

            echo "ğŸš€ ĞŸĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑĞº"
            docker-compose up -d

            echo "âœ… Ğ”ĞµĞ¿Ğ»Ğ¾Ğ¹ Ğ·Ğ°Ğ²ĞµÑ€ÑˆÑ‘Ğ½: $(date)"
          EOF
